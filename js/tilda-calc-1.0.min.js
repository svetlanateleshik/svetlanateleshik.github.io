function tcalc__init(e,a){var t=$("#rec"+e),c=t.find("[data-input-lid="+a+"]"),l=c.find(".t-calc"),r=l.attr("data-calc-expr");if(void 0!==r){r=r.replace(/\s/g,"").replace(/,/g,".");var n=tcalc__parseExpression(r);tcalc__cashOperandsFieldsEls(t,n),tcalc__cutAndHideFieldsValues(n),!0!==n.error?(tcalc__changeVal(c,l,tcalc__calcValue(n)),setTimeout(function(e){tcalc__changeVal(c,l,tcalc__calcValue(n))},1),t.find(".t-input").keyup(function(){tcalc__changeVal(c,l,tcalc__calcValue(n))}),t.find(".t-select, .t-radio, .t-checkbox, .t-img-select").on("change",function(e){tcalc__changeVal(c,l,tcalc__calcValue(n))}),t.find(".t-inputquantity__btn").on("click",function(e){tcalc__changeVal(c,l,tcalc__calcValue(n))}),t.find(".t-range").on("input",function(e){tcalc__changeVal(c,l,tcalc__calcValue(n))})):console.log("Please check math expression or input names(especially spaces) in rec"+e)}else console.log("Error: formula field is empty in rec"+e)}function tcalc__changeVal(e,a,t){if(isNaN(t)?(a.html(0),e.find(".t-calc__hiddeninput").val(0)):(a.html(t),e.find(".t-calc__hiddeninput").val(t)),e.find('input[type="hidden"][class^="t-calc__hidden__prod"]').length>0){var c=e.parents(".t-form__inputsbox"),l=e.find(".t-calc__hidden__prod_img").val()||"",r=e.find(".t-calc__hidden__prod_title").val()||"NoName",n={str:r,variables:[]},s=n.str.match(/[A-z0-9_]+/gi);for(var i in s){var _=c.find('[type="radio"][name="'+s[i]+'"]:checked');if(1===_.length)n.variables.push({str:s[i],value:_.val()});else{var o=c.find('[name="'+s[i]+'"]');1===o.length&&n.variables.push({str:s[i],value:o.val()})}}for(var u in n.variables){var p=n.variables[u].str,d=n.variables[u].value;void 0!==p&&void 0!==d&&(r=r.replace(new RegExp(p),d))}var v=c.find('[class$="-form__submit"]').find("button.t-submit"),f="#order:"+r+"="+t;""!==l&&(f+=":::image="+l),v.attr("href",f),v.attr("type","")}}function tcalc__calcValue(e){tcalc__getFieldsValues(e);for(var a=e.str,t=0;t<e.operands.length;t++){var c=e.operands[t].value;c=c<0?"(0"+c+")":c,a=a.replace(e.operands[t].str,c)}try{var l=tcalc__evaluate(tcalc__parse(a))}catch(e){console.log("Something went wrong in form calculator! Please, connect support or developers")}return Math.round(10*l)/10}function tcalc__parseExpression(e){var a=e.split(""),t=[],c=[],l=0,r=!0;t[l]=Object.create(null),t[l].str="";for(var n=0;n<a.length;n++)"("!=a[n]&&")"!=a[n]&&("+"!=a[n]&&"-"!=a[n]&&"*"!=a[n]&&"/"!=a[n]||r?(t[l].str+=a[n],r=!1):(c[l]=a[n],l++,t[l]=Object.create(null),t[l].str="",r=!0));return{str:e,operands:t,operators:c}}function tcalc__cashOperandsFieldsEls(e,a){for(var t=0;t<a.operands.length;t++){var c=a.operands[t].str;if($.isNumeric(c))a.operands[t].type="number",a.operands[t].value=1*a.operands[t].str;else{var l=e.find("[name="+c+"]");if(0===l.length)return console.log("Error: incorrect operand: "+c),void(a.error=!0);a.operands[t].type="variable",a.operands[t].el_field=l}}}function tcalc__cutAndHideFieldsValues(e){for(var a=0;a<e.operands.length;a++){var t=e.operands[a];if("variable"===t.type){var c=t.el_field;if(c.hasClass("t-select"))for(var l=c.find("option"),r=0;r<l.length;r++){var n=l[r],s=n.value;if(void 0!==s&&""!==s){var i=s.split("=");n.value=i[0],$(n).html(i[0]),$(n).attr("data-calc-value",i[1])}}if(c.hasClass("t-checkboxes__hiddeninput")||c.hasClass("t-checkbox")||c.hasClass("t-radio")){if(c.hasClass("t-checkboxes__hiddeninput"))var _=t.el_field.parents(".t-input-block").find(".t-checkbox");else _=c;for(r=0;r<_.length;r++){var o=$(_[r]),u=o.hasClass("t-radio")?o.parents(".t-radio__control"):o.parents(".t-checkbox__control"),p=u.find(".t-checkbox__labeltext");s=u.text();if(p.length>0&&(s=p.text()),void 0!==s){i=s.split("=");if(0!==o.parents(".t-input-group_rd").length&&o.attr("value",i[0]),o.attr("data-calc-value",i[1]),p.length>0)p.text(i[0]);else{var d=u.children();u.contents().last()[0].textContent=i[0],u.prepend(d)}}}}if(c.hasClass("t-img-select__hiddeninput")||c.hasClass("t-img-select")){if(c.hasClass("t-img-select__hiddeninput"))_=t.el_field.parents(".t-input-block").find(".t-img-select");else _=c;for(r=0;r<_.length;r++){o=$(_[r]),u=o.parents(".t-img-select__control");var v=u.find(".t-img-select__text");s=v.text();if(void 0!==s){i=s.split("=");""===i[0]||" "===i[0]?o.attr("value",u.find(".t-img-select__indicator").attr("data-original")):o.attr("value",i[0]),o.attr("data-calc-value",i[1]),v.text(i[0])}}}}}}function tcalc__getFieldsValues(e){for(var a=0;a<e.operands.length;a++)if("variable"==e.operands[a].type){var t=e.operands[a].el_field,c=t.hasClass("t-img-select")&&"radio"===t.attr("type"),l=t.hasClass("t-img-select__hiddeninput");if(t.hasClass("t-input")||t.hasClass("t-range")||t.hasClass("t-calc__hiddeninput")){var r=t.val();tcalc__getFieldsValues__saveToArr(e.operands[a],r)}if(t.hasClass("t-select")){var n=t.find("option:selected");r=n.attr("data-calc-value");tcalc__getFieldsValues__saveToArr(e.operands[a],r)}if(t.hasClass("t-radio")||t.hasClass("t-checkbox")||c){var s=t.filter(":checked");r=s.attr("data-calc-value");tcalc__getFieldsValues__saveToArr(e.operands[a],r)}if(t.hasClass("t-checkboxes__hiddeninput")||l){for(var i=l?t.parents(".t-input-block").find(".t-img-select:checked"):t.parents(".t-input-block").find(".t-checkbox:checked"),_=0,o=0;o<i.length;o++){var u=i[o];r=$(u).attr("data-calc-value");r=void 0!==r?r.replace(/[^0-9.]/g,""):0,_+=parseFloat(r)}tcalc__getFieldsValues__saveToArr(e.operands[a],_.toString())}}}function tcalc__getFieldsValues__saveToArr(e,a){var t=parseInt(a,10)<0;a=void 0!==a?a.replace(/,/g,".").replace(/[^0-9.]/g,""):"",e.value=""===a?0:parseFloat(a),t&&(e.value=-e.value)}function tcalc__evaluate(e){switch(e.type){case"number":return parseFloat(e.value);case"+":return tcalc__evaluate(e.left)+tcalc__evaluate(e.right);case"-":return tcalc__evaluate(e.left)-tcalc__evaluate(e.right);case"*":return tcalc__evaluate(e.left)*tcalc__evaluate(e.right);case"/":return tcalc__evaluate(e.left)/tcalc__evaluate(e.right)}}function tcalc__parse(e){var a={tokens:tcalc__tokenize(e),position:0},t=tcalc__parseExpr(a);if(a.position!==a.tokens.length)throw new SyntaxError("unexpected '"+tcalc__peek(a)+"'");return t}function tcalc__parseExpr(e){for(var a=tcalc__parseMulExpr(e),t=tcalc__peek(e);"+"===t||"-"===t;){tcalc__consume(e,t);var c=tcalc__parseMulExpr(e);a={type:t,left:a,right:c},t=tcalc__peek(e)}return a}function tcalc__parseMulExpr(e){for(var a=tcalc__parsePrimaryExpr(e),t=tcalc__peek(e);"*"===t||"/"===t;){tcalc__consume(e,t);var c=tcalc__parsePrimaryExpr(e);a={type:t,left:a,right:c},t=tcalc__peek(e)}return a}function tcalc__parsePrimaryExpr(e){var a=tcalc__peek(e);if(tcalc__isNumber(a))return tcalc__consume(e,a),{type:"number",value:a};if(tcalc__isName(a))return tcalc__consume(e,a),{type:"name",id:a};if("("===a){tcalc__consume(e,a);var t=tcalc__parseExpr(e);if(")"!==tcalc__peek(e))throw new SyntaxError("expected )");return tcalc__consume(e,")"),t}throw new SyntaxError("expected a number, a variable, or parentheses")}function tcalc__peek(e){return e.tokens[e.position]}function tcalc__consume(e,a){e.position++}function tcalc__tokenize(e){for(var a,t=[],c=/\s*([A-Za-z]+|[0-9.]+|\S)\s*/g;null!==(a=c.exec(e));)t.push(a[1]);return t}function tcalc__isName(e){return void 0!==e&&null!==e.match(/^[A-Za-z]+$/)}function tcalc__isNumber(e){return void 0!==e&&null!==e.match(/^[0-9.]+$/)}